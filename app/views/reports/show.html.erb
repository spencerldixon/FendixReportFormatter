<script src="http://maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='http://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>


<p id="notice"><%= notice %></p>

<div class="page-header">
	<h1><%= @report.name %> Report</h1>
	<p>Report Generated by <%= fullname(@report.user) %></p>
</div>

<% if @report.line_items.blank? %>
	<p>There is no data in this report, would you like to <a href="#" data-toggle="modal" data-target="#importModal">Import Date into this Report</a>?</p>
<% else %>


<%= button_to "Download this report as a PDF", report_path(@report, :format => "pdf"), method: :get, class: "no-pdf btn btn-primary" %>


	<div class="row">
		<div class="col-lg-6">
			<div class="page-header">
				<h3>Your Campaign Summary</h3>
			</div>
			<h4>Total Page Impressions: <%= @report.total_impressions %></h4>
			<h4>Total Clicks: <%= @report.total_clicks %></h4>
			<h4>Average CTR: <%= @report.average_ctr %></h4>
			<h4>Best Performing Site by CTR: <%= @report.best_performing_site %></h4>
		</div>

		<div class="col-lg-6">
			<div class="page-header">
				<h3>Your Campaign Locations</h3>
			</div>
			<div id="map" style='height: 400px;'></div>
		</div>
	</div>

	<div class="page-header campaign-data">
		<h3>Your Campaign Data</h3>
	</div>
	<table class="table">
		<thead>
			<tr>
				<th>Date</th>
				<th>Campaign</th>
				<th>Site</th>
				<th>Impressions</th>
				<th>Clicks</th>
				<th>CTR</th>
			</tr>
		</thead>

		<tbody>
			<% @report.line_items.each do |line_item| %>
				<tr>
					<td><%= line_item.date %></td>
					<td><%= line_item.campaign %></td>
					<td><%= link_to line_item.site.name, site_path(line_item.site) %></td>
					<td><%= line_item.impressions %></td>
					<td><%= line_item.clicks %></td>
					<td><%= line_item.ctr %></td>
				</tr>
			<% end %>
		</tbody>
	</div>
<% end %>

<script type="text/javascript">
	handler = Gmaps.build('Google');
	handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
	  markers = handler.addMarkers(<%=raw @hash.to_json %>);
	  handler.bounds.extendWith(markers);
	  handler.fitMapToBounds();
	});
</script>

<%= render 'layouts/import_line_items_modal' %>


<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
	google.setOnLoadCallback(drawChart);
	function drawChart() {
		  var data = google.visualization.arrayToDataTable(<%= raw get_impressions_array(@report) %>);
		  	/*[
		    ['Site', 'Impressions'],
		    ['Blackpool',  1000],
		    ['East Kent',  1170]
		  ]*/
		  	

		  var options = {
		    title: 'Impressions by Site',
		    hAxis: {title: 'Campaign Locations', titleTextStyle: {color: 'black'}}
		  };

		  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
		  chart.draw(data, options);
	}
</script>


<div class="row">
	<div class="col-lg-4">
		<div id="chart_div"></div>
	</div>

	<div class="col-lg-4">
		<div id="chart_div_2"></div>
	</div>

	<div class="col-lg-4">
		<div id="chart_div_3"></div>
	</div>
</div>

<%= get_impressions_array(@report) %>

<div class="no-pdf">
<%= link_to 'Edit', edit_report_path(@report) %> |
<%= link_to 'Back', reports_path %>
</div>
