<script src="http://maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='http://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>


<p id="notice"><%= notice %></p>

<div class="page-header">
	<h1><%= @report.name %> Report</h1><div id="logo"><%= image_tag "fendix_logo.jpg", width: 300 %></div>
	<p>Report Generated by <%= fullname(@report.user) %></p>
</div>

<% if @report.line_items.blank? %>
	<p>There is no data in this report, would you like to <a href="#" data-toggle="modal" data-target="#importModal">Import Date into this Report</a>?</p>

<% else %>
	<div class="no-pdf">
		<div class="btn-group">
			<%= button_to 'Back', reports_path, method: :get, class: "btn btn-primary" %>
		</div>
		<div class="btn-group">
			<%= button_to 'Edit this Report', edit_report_path(@report), method: :get, class: "btn btn-primary" %>
		</div>
		<div class="btn-group">
			<%= button_to "Download this report as a PDF", report_path(@report, :format => "pdf"), method: :get, class: "btn btn-primary" %>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-6">
			<div class="page-header">
				<h3>Your Campaign Summary</h3>
			</div>

			<div class="stats">
				<div class="col-lg-6">
					<h4>Report Start Date:</h4>
					<h4>Report End Date:</h4>
					<h4>Total Page Impressions:</h4>
					<h4>Total Clicks:</h4>
					<h4>Average CTR:</h4>
					<h4>Best Performing Site by CTR:</h4>
				</div>
				<div class="col-lg-6">
					<h4 class="text-primary">Blank</h4>
					<h4 class="text-primary">Blank</h4>
					<h4 class="text-primary"><%= number_with_delimiter(@report.total_impressions, :delimiter => ',') %></h4>
					<h4 class="text-primary"><%= number_with_delimiter(@report.total_clicks, :delimiter => ',') %></h4>
					<h4 class="text-primary"><%= number_with_precision(@report.average_ctr, :precision => 3) %>%</h4>
					<h4 class="text-primary"><%= @report.best_performing_site %></h4>
				</div>
			</div>
		</div>

		<div class="col-lg-6">
			<div class="page-header">
				<h3>Your Campaign Locations</h3>
			</div>
			<div id="map" style='height: 400px;'></div>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-4">
			<div class="page-header">
				<h3>Impressions by Site</h3>
			</div>
			<div id="chart_div_impressions" class="graph" style="height:400px;"></div>
		</div>

		<div class="col-lg-4">
			<div class="page-header">
				<h3>Click Throughs by Site</h3>
			</div>
			<div id="chart_div_clicks" class="graph" style="height:400px;"></div>
		</div>

		<div class="col-lg-4">
			<div class="page-header">
				<h3>Click Through Rate by Site</h3>
			</div>
			<div id="chart_div_ctr" class="graph" style="height:400px;"></div>
		</div>
	</div>

	<div class="row">
		<div class="page-header campaign-data">
			<h3>Your Campaign Data</h3>
		</div>
		<table class="table">
			<thead>
				<tr>
					<th>Date</th>
					<th>Campaign</th>
					<th>Site</th>
					<th>Impressions</th>
					<th>Clicks</th>
					<th>CTR</th>
				</tr>
			</thead>

			<tbody>
				<% @report.line_items.each do |line_item| %>
					<tr>
						<td><%= line_item.date %></td>
						<td><%= line_item.campaign %></td>
						<td><%= link_to line_item.site.name, site_path(line_item.site) %></td>
						<td><%= line_item.impressions %></td>
						<td><%= line_item.clicks %></td>
						<td><%= number_with_precision(line_item.ctr, :precision => 3) %>%</td>
					</tr>
				<% end %>
			</tbody>
		</table>
	</div>

<% end %>



<%= render 'layouts/import_line_items_modal' %>


<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
	google.setOnLoadCallback(drawChart);
	function drawChart() {
		  var data = google.visualization.arrayToDataTable(<%= raw get_impressions_array(@report) %>);
		  var options = {
		  	legend: {position: 'none'},
		    colors: ['#008AC1']
		  };
		  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div_impressions'));
		  chart.draw(data, options);
	}
</script>

<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
	google.setOnLoadCallback(drawChart);
	function drawChart() {
		  var data = google.visualization.arrayToDataTable(<%= raw get_clicks_array(@report) %>);
		  var options = {
		    legend: {position: 'none'},
		    colors: ['#004F92']
		  };
		  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div_clicks'));
		  chart.draw(data, options);
	}
</script>

<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
	google.setOnLoadCallback(drawChart);
	function drawChart() {
		  var data = google.visualization.arrayToDataTable(<%= raw get_ctr_array(@report) %>);
		  var options = {
		    legend: {position: 'none'},
		    colors: ['#87888a']
		  };
		  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div_ctr'));
		  chart.draw(data, options);
	}
</script>

<script type="text/javascript">
	handler = Gmaps.build('Google');
	handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
	  markers = handler.addMarkers(<%=raw @hash.to_json %>);
	  handler.bounds.extendWith(markers);
	  handler.fitMapToBounds();
	});
</script>